<h1>„Çø„Ç§„É†„É©„Ç§„É≥</h1>

<%# --- „Ç≠„É£„É©„ÇØ„Çø„ÉºÂøúÊè¥„Ç®„É™„Ç¢ --- %>
<% if @character.present? %>
  <div class="character-cheer">
    <h4><%= @character.name %>„Åã„Çâ„ÅÆÂøúÊè¥„É°„ÉÉ„Çª„Éº„Ç∏</h4>
    <%= image_tag @character.image_url, alt: @character.name, width: 100 %>
    <p class="cheer-message"><%= @character.cheer_message %></p>
  </div>
<% end %>


<%# --- Êñ∞Ë¶èÊäïÁ®ø„É™„É≥„ÇØ --- %>
<p>
  <% if user_signed_in? %>
    <%= link_to "Êñ∞„Åó„ÅÑÊäïÁ®ø„Çí‰ΩúÊàê„Åô„Çã", new_post_path %>
  <% end %>
</p>

<hr>

<%# --- ÊäïÁ®ø‰∏ÄË¶ß„Ç®„É™„Ç¢ --- %>
<div class="posts-list">
  <% if @posts.any? %>
    <% @posts.each do |post| %>
      <div class="post" style="margin-bottom: 40px;">

        <%# ÊäïÁ®ø„Éò„ÉÉ„ÉÄ„Éº (ÊäïÁ®øËÄÖ„Å®ÊôÇÈñì) %>
        <div class="post-header">
          <p>
            <strong><%= post.user.name %></strong>
            <span style="color: #888; font-size: 0.9em;">
              <%= time_ago_in_words(post.created_at) %>Ââç
            </span>
          </p>
        </div>

        <%# ÊäïÁ®øÂÜÖÂÆπ %>
        <div class="post-content">
          <p>
            <%= simple_format(post.content) %>
          </p>
        </div>

        <%# ÊäïÁ®ø„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ („ÅÑ„ÅÑ„Å≠/Á∑®ÈõÜ/ÂâäÈô§) %>
        <div class="post-actions" style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
          <%# „ÅÑ„ÅÑ„Å≠Ê©üËÉΩ„Ç®„É™„Ç¢ (Turbo Frame„ÅßÂõ≤„ÇÄ) %>
          <%= turbo_frame_tag "like_buttons_for_post_#{post.id}" do %>
            <div class="like-buttons">
              <% if user_signed_in? %>
                <% if current_user.liked?(post) %>
                  <%# „ÅÑ„ÅÑ„Å≠Ê∏à„Åø„ÅÆÂ†¥Âêà ‚Üí „ÅÑ„ÅÑ„Å≠Ëß£Èô§„Éú„Çø„É≥ %>
                  <% like = current_user.likes.find_by(post_id: post.id) %>
                  <%= link_to "‚ù§Ô∏è #{post.likes.count}", post_like_path(post, like), data: { turbo_method: :delete }, style: "color: #e25555; font-size: 1.2em;" %>
                <% else %>
                  <%# „Åæ„Å†„ÅÑ„ÅÑ„Å≠„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà ‚Üí „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ %>
                  <%= link_to "ü§ç #{post.likes.count}", post_likes_path(post), data: { turbo_method: :post }, style: "color: #aaa; font-size: 1.2em;" %>
                <% end %>
              <% else %>
                <span style="font-size: 1.2em;">ü§ç <%= post.likes.count %></span>
              <% end %>
            </div>
          <% end %>

          <%# "ÊäïÁ®ø"„ÅÆÁ∑®ÈõÜ„ÉªÂâäÈô§„Éú„Çø„É≥ %>
          <% if post.user == current_user %>
            <%= link_to 'Á∑®ÈõÜ', edit_post_path(post) %>
            <%= link_to 'ÂâäÈô§', post_path(post), data: { turbo_method: :delete, turbo_confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' } %>
          <% end %>
        </div>
        
        <%# „Ç≥„É°„É≥„ÉàÊ©üËÉΩ„Ç®„É™„Ç¢ %>
        <div class="comments-section" style="margin-top: 15px; padding-left: 20px; border-left: 3px solid #eee;">
          <strong>„Ç≥„É°„É≥„Éà</strong>
          
          <%# „Ç≥„É°„É≥„Éà‰∏ÄË¶ß %>
          <div class="comments-list" id="comments-for-post-<%= post.id %>">
            <% if post.comments.any? %>
              <% post.comments.each do |comment| %>
                <div class="comment" style="font-size: 0.9em; margin-top: 5px; display: flex; align-items: center; gap: 10px;">
                  
                  <%# „Ç≥„É°„É≥„ÉàÂÜÖÂÆπ %>
                  <div>
                    <strong><%= comment.user.name %>:</strong>
                    <span><%= comment.content %></span>
                  </div>

                  <%# "„Ç≥„É°„É≥„Éà"„ÅÆÁ∑®ÈõÜ„ÉªÂâäÈô§„Éú„Çø„É≥ (Ê≠£„Åó„ÅÑ‰ΩçÁΩÆ) %>
                  <div class="comment-actions" style="font-size: 0.8em;">
                    <% if comment.user == current_user %>
                      <%= link_to 'Á∑®ÈõÜ', edit_post_comment_path(post, comment) %>
                      <%= link_to 'ÂâäÈô§', post_comment_path(post, comment), data: { turbo_method: :delete, turbo_confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' } %>
                    <% end %>
                  </div>

                </div>
              <% end %>
            <% else %>
              <p class="no-comments" style="font-size: 0.9em; color: #888;">„Åæ„Å†„Ç≥„É°„É≥„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
            <% end %>
          </div>
          
          <%# „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† %>
          <div class="comment-form" style="margin-top: 10px;">
            <% if user_signed_in? %>
              <%= form_with model: [post, Comment.new], local: true do |f| %>
                <%= f.text_area :content, rows: 2, placeholder: "„Ç≥„É°„É≥„Éà„ÇíËøΩÂä†..." %>
                <%= f.submit "ÈÄÅ‰ø°" %>
              <% end %>
            <% end %>
          </div>
        </div>

        <%# ‚ñº‚ñº‚ñº „ÇÇ„Å®„ÇÇ„Å®„Åì„Åì„Å´„ÅÇ„Å£„Åü„Ç®„É©„Éº„ÅÆÂéüÂõ†„ÅÆ„Éñ„É≠„ÉÉ„ÇØ„ÅØÂâäÈô§„Åó„Åæ„Åó„Åü ‚ñº‚ñº‚ñº %>

      </div>
      <hr>
    <% end %>
  <% else %>
    <p>„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÊúÄÂàù„ÅÆÊäïÁ®ø„Çí„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
  <% end %>
</div>